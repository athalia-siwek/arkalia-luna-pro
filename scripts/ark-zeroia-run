#!/bin/bash

set -e

PROJECT_DIR="/Volumes/T7/devstation/cursor/arkalia-luna-pro"
ZEROIA_DIR="$PROJECT_DIR/modules/zeroia"
REASON_LOOP="$ZEROIA_DIR/reason_loop.py"
SNAPSHOT_GENERATOR="$ZEROIA_DIR/snapshot_generator.py"
FAILSAFE="$ZEROIA_DIR/failsafe.py"
REASONING_HISTORY="$ZEROIA_DIR/logs/reasoning_history.md"

timestamp=$(date +"%Y-%m-%d %H:%M:%S")

echo "ðŸŒ [$timestamp] Lancement de ZeroIAâ€¦"
echo "ðŸ“Œ CrÃ©ation du snapshotâ€¦"
python "$SNAPSHOT_GENERATOR"

echo "ðŸ§  Lancement de reason_loop.pyâ€¦"
python "$REASON_LOOP" || {
    echo "âš ï¸ Ã‰chec de reason_loop.py â€” dÃ©clenchement du failsafe"
    python "$FAILSAFE"
    exit 1
}

echo "ðŸ“˜ Ã‰criture dans reasoning_history.mdâ€¦"
echo -e "\n---\n[$timestamp] DÃ©cision exÃ©cutÃ©e avec succÃ¨s.\nSnapshot : zeroia_snapshot.toml" >> "$REASONING_HISTORY"

echo "âœ… ZeroIA terminÃ© proprement."
